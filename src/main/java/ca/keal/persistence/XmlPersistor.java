package ca.keal.persistence;

import org.w3c.dom.Document;

/**
 * Handles persisting an @{@link Persistable} object of type {@code R} to XML and regenerating it from XML.
 * @param <R> The type of object that may be persisted or regenerated by this {@code XmlPersistor}. This must
 *  be @{@link Persistable} with {@code toplevel=true}.
 */
public class XmlPersistor<R> {
  
  private final Class<R> rootClass;
  private final Persistable rootAnnotation;
  
  /**
   * Instantiate an {@link XmlPersistor}.
   * @param rootClass The class of the object to be persisted or regenerated. This must be @{@link Persistable} with
   *  {@code toplevel=true}.
   * @throws NullPointerException If {@code rootClass} is {@code null}.
   * @throws PersistenceException If {@code rootClass} does not meet the above criteria.
   */
  public XmlPersistor(Class<R> rootClass) {
    if (rootClass == null) {
      throw new NullPointerException("rootClass cannot be null");
    }
    
    rootAnnotation = PersistenceUtil.verifyAndGetPersistable(rootClass);
    if (!rootAnnotation.toplevel()) {
      throw new PersistenceException(rootClass.getCanonicalName()
          + " is the root class and as such must have toplevel=true in @Persistable");
    }
    
    this.rootClass = rootClass;
  }
  
  /**
   * Persist {@code root} to an XML document.
   * @param root The object to be persisted.
   * @return The XML document representing the persisted version of {@code root}.
   * @throws NullPointerException If {@code root} is {@code null}.
   * @throws PersistenceException If an error is encountered when persisting {@code root}.
   */
  public Document toXml(R root) {
    throw new UnsupportedOperationException("Not yet implemented");
  }
  
  /**
   * Regenerate an object from {@code doc}.
   * @param doc The XML document from which to regenerate the object.
   * @return The object regenerated from {@code doc}.
   * @throws NullPointerException If {@code doc} is {@code null}.
   * @throws PersistenceException If an error is encountered when regenerating the object.
   */
  public R fromXml(Document doc) {
    throw new UnsupportedOperationException("Not yet implemented");
  }
  
}
